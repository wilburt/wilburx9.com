{"version":3,"file":"load-more.js","sources":["load-more.js"],"sourcesContent":["let loadMore\n\nfunction setupInfiniteScroll(maxPages, pageTag) {\n    if (loadMore) loadMore.cleanUp()\n    loadMore = new LoadMore(maxPages, pageTag)\n}\n\nclass LoadMore {\n    animation\n    loading = false\n    offset = 300\n    currentPage = 1\n    rafId\n    disposed = false\n\n    constructor(maxPages, pageTag) {\n        this.maxPages = maxPages\n        this.pageTag = pageTag || \"\"\n        this.baseUrl = `${document.location.origin}/blog/${pageTag}`\n        this.$scrollingContent = $('.gh-content')\n\n        this.cleanUp = this.cleanUp.bind(this)\n        this.showLoader = this.showLoader.bind(this)\n        this.hideLoader = this.hideLoader.bind(this)\n        this.handleScroll = this.handleScroll.bind(this)\n        this.handleResize = this.handleResize.bind(this)\n        this.loadMorePosts = this.loadMorePosts.bind(this)\n        this.setEventListeners = this.setEventListeners.bind(this)\n        this.removeEventListeners = this.removeEventListeners.bind(this)\n\n        this.setEventListeners()\n        this.loadMorePosts()\n    }\n\n    setEventListeners() {\n        this.$scrollingContent.on('scroll', this.handleScroll)\n        $(window).on('resize', this.handleResize)\n    }\n\n    removeEventListeners() {\n        this.$scrollingContent.off('scroll', this.handleScroll)\n        $(window).off('resize', this.handleResize)\n    }\n\n    loadMorePosts() {\n        if (this.rafId) cancelAnimationFrame(this.rafId) // Using this to debounce the scroll event\n\n        // Don't fetch more posts if a request is in progress or if all posts has been loaded\n        if (this.loading || this.currentPage >= this.maxPages) return\n\n        this.rafId = window.requestAnimationFrame(() => {\n            const bottom = this.$scrollingContent[0].scrollHeight - this.$scrollingContent.innerHeight() - this.offset\n            if (this.$scrollingContent.scrollTop() >= bottom) this.fetchPosts()\n        })\n\n    }\n\n    fetchPosts() {\n        this.loading = true\n        this.showLoader()\n        let nextPage = `page/${++this.currentPage}/`\n        $.ajax({\n            url: this.baseUrl + nextPage,\n            type: 'GET',\n            success: data => {\n                if (this.disposed) return\n                const newPosts = $(data).find('.gh-card, .post');\n                newPosts.hide()\n                $('.gh-post-feed').append(newPosts)\n                this.hideLoader(newPosts)\n            },\n            error: (jqXHR) => {\n                if (this.disposed) return\n                if (jqXHR.status === 404) this.removeEventListeners()\n                this.hideLoader()\n            },\n            complete: () => {\n                if (this.currentPage >= this.maxPages) this.removeEventListeners()\n                this.loading = false\n            }\n        })\n    }\n\n    showLoader() {\n        $('.gh-post-feed-footer-info').addClass('hide')\n        let $loader = $('.gh-more-post-loader #more-loader')\n        this.animation = bodymovin.loadAnimation({\n            container: $loader[0],\n            renderer: 'svg',\n            loop: true,\n            autoplay: true,\n            path: '/assets/lottie/loading.json'\n        })\n        $loader.stop().fadeIn(300, 'linear')\n    }\n\n    hideLoader(newPosts) {\n        let $loader = $('.gh-more-post-loader #more-loader')\n\n        $loader.stop().fadeOut(300, 'linear', () => {\n            if (newPosts) newPosts.fadeIn(300, 'linear')\n            $('.gh-post-feed-footer-info').removeClass('hide')\n            $loader.children().empty()\n            if (this.animation) {\n                this.animation.stop();\n                this.animation.destroy();\n            }\n        })\n    }\n\n    handleScroll() {\n        this.loadMorePosts()\n    }\n\n    handleResize() {\n        this.loadMorePosts()\n    }\n\n    cleanUp() {\n        this.disposed = true\n        this.hideLoader()\n        this.removeEventListeners()\n    }\n\n}"],"names":["let","loadMore","setupInfiniteScroll","maxPages","pageTag","cleanUp","LoadMore","animation","loading","offset","currentPage","rafId","disposed","constructor","this","baseUrl","document","location","origin","$scrollingContent","$","bind","showLoader","hideLoader","handleScroll","handleResize","loadMorePosts","setEventListeners","removeEventListeners","on","window","off","cancelAnimationFrame","requestAnimationFrame","bottom","scrollHeight","innerHeight","scrollTop","fetchPosts","nextPage","ajax","url","type","success","data","newPosts","find","hide","append","error","jqXHR","status","complete","addClass","$loader","bodymovin","loadAnimation","container","renderer","loop","autoplay","path","stop","fadeIn","fadeOut","removeClass","children","empty","destroy"],"mappings":"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"}