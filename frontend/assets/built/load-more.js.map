{"version":3,"file":"load-more.js","sources":["load-more.js"],"sourcesContent":["let loadMore\n\nfunction setupInfiniteScroll(maxPages, pageTag) {\n    if (loadMore) loadMore.cleanUp()\n    loadMore = new LoadMore(maxPages, pageTag)\n}\n\nclass LoadMore {\n    animation\n    loading = false\n    offset = 300\n    currentPage = 1\n    rafId\n    disposed = false\n\n    constructor(maxPages, pageTag) {\n        console.log(`${pageTag} :: Instantiated with ${maxPages} pages`)\n        this.maxPages = maxPages\n        this.pageTag = pageTag || \"\"\n        this.baseUrl = `${document.location.origin}/blog/${pageTag}`\n        this.$scrollingContent = $('.gh-content')\n\n        this.cleanUp = this.cleanUp.bind(this)\n        this.showLoader = this.showLoader.bind(this)\n        this.hideLoader = this.hideLoader.bind(this)\n        this.handleScroll = this.handleScroll.bind(this)\n        this.handleResize = this.handleResize.bind(this)\n        this.loadMorePosts = this.loadMorePosts.bind(this)\n        this.setEventListeners = this.setEventListeners.bind(this)\n        this.removeEventListeners = this.removeEventListeners.bind(this)\n\n        this.setEventListeners()\n        this.loadMorePosts()\n    }\n\n    setEventListeners() {\n        console.log(`${this.pageTag} :: setEventListeners`)\n        this.$scrollingContent.on('scroll', this.handleScroll)\n        $(window).on('resize', this.handleResize)\n    }\n\n    removeEventListeners() {\n        console.log(`${this.pageTag} :: removeEventListeners`)\n        this.$scrollingContent.off('scroll', this.handleScroll)\n        $(window).off('resize', this.handleResize)\n    }\n\n    loadMorePosts() {\n        if (this.rafId) {\n            cancelAnimationFrame(this.rafId)\n        }\n\n        if (this.loading) {\n            console.log(`${this.pageTag} :: loadMorePosts :: loading Returning`)\n            return\n        }\n\n        this.rafId = window.requestAnimationFrame(() => {\n            const bottom = this.$scrollingContent[0].scrollHeight - this.$scrollingContent.innerHeight() - this.offset\n            if (this.$scrollingContent.scrollTop() >= bottom) {\n                this.fetchPosts()\n            } else {\n                console.log(`${this.pageTag} :: loadMorePosts :: Not at the bottom`)\n            }\n        })\n\n    }\n\n    fetchPosts() {\n        this.loading = true\n        this.showLoader()\n        let nextPage = `page/${++this.currentPage}/`\n        console.log(`${this.pageTag} :: fetchPosts :: ${nextPage}`)\n        setTimeout(() => {\n            $.ajax({\n                url: this.baseUrl + nextPage,\n                type: 'GET',\n                success: data => {\n                    console.log(`${this.pageTag} :: fetchPosts :: success`)\n                    if (this.disposed) {\n                        console.log(`${this.pageTag} :: fetchPosts :: not updating after success`)\n                        return\n                    }\n                    const newPosts = $(data).find('.gh-card, .post');\n                    newPosts.hide()\n                    $('.gh-post-feed').append(newPosts)\n                    this.hideLoader(newPosts)\n                },\n                error: (jqXHR) => {\n                    if (this.disposed) {\n                        console.log(`${this.pageTag} :: fetchPosts :: not updating after error`)\n                        return\n                    }\n                    console.log(`${this.pageTag} :: fetchPosts :: error`)\n                    if (jqXHR.status === 404) this.removeEventListeners()\n                    this.hideLoader()\n                },\n                complete: () => {\n                    console.log(`${this.pageTag} :: fetchPosts :: complete`)\n                    if (this.currentPage >= this.maxPages) this.removeEventListeners()\n                    this.loading = false\n                }\n            })\n        }, 10000);\n    }\n\n    showLoader() {\n        $('.gh-post-feed-footer-info').addClass('hide')\n        let $loader = $('.gh-more-post-loader #more-loader')\n        this.animation = bodymovin.loadAnimation({\n            container: $loader[0],\n            renderer: 'svg',\n            loop: true,\n            autoplay: true,\n            path: '/assets/lottie/loading.json'\n        })\n        $loader.stop().fadeIn(300, 'linear')\n    }\n\n    hideLoader(newPosts) {\n        let $loader = $('.gh-more-post-loader #more-loader')\n        $loader.stop().fadeOut(300, 'linear', () => {\n            if (newPosts) {\n                newPosts.fadeIn(300, 'linear')\n            }\n            $('.gh-post-feed-footer-info').removeClass('hide')\n            $loader.children().empty()\n            if (this.animation) {\n                this.animation.stop();\n                this.animation.destroy();\n            }\n        })\n    }\n\n    handleScroll() {\n        this.loadMorePosts()\n    }\n\n    handleResize() {\n        this.loadMorePosts()\n    }\n\n    cleanUp() {\n        this.disposed = true\n        this.hideLoader()\n        this.removeEventListeners()\n    }\n\n}"],"names":["let","loadMore","setupInfiniteScroll","maxPages","pageTag","cleanUp","LoadMore","animation","loading","offset","currentPage","rafId","disposed","constructor","console","log","this","baseUrl","document","location","origin","$scrollingContent","$","bind","showLoader","hideLoader","handleScroll","handleResize","loadMorePosts","setEventListeners","removeEventListeners","on","window","off","cancelAnimationFrame","requestAnimationFrame","bottom","scrollHeight","innerHeight","scrollTop","fetchPosts","nextPage","setTimeout","ajax","url","type","success","data","newPosts","find","hide","append","error","jqXHR","status","complete","addClass","$loader","bodymovin","loadAnimation","container","renderer","loop","autoplay","path","stop","fadeIn","fadeOut","removeClass","children","empty","destroy"],"mappings":"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"}