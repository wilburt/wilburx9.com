let loadMore;function setupInfiniteScroll(e,s){loadMore&&loadMore.cleanUp(),loadMore=new LoadMore(e,s)}class LoadMore{animation;loading=!1;offset=300;currentPage=1;rafId;disposed=!1;constructor(e,s){console.log(s+` :: Instantiated with ${e} pages`),this.maxPages=e,this.pageTag=s||"",this.baseUrl=document.location.origin+"/blog/"+s,this.$scrollingContent=$(".gh-content"),this.cleanUp=this.cleanUp.bind(this),this.showLoader=this.showLoader.bind(this),this.hideLoader=this.hideLoader.bind(this),this.handleScroll=this.handleScroll.bind(this),this.handleResize=this.handleResize.bind(this),this.loadMorePosts=this.loadMorePosts.bind(this),this.setEventListeners=this.setEventListeners.bind(this),this.removeEventListeners=this.removeEventListeners.bind(this),this.setEventListeners(),this.loadMorePosts()}setEventListeners(){console.log(this.pageTag+" :: setEventListeners"),this.$scrollingContent.on("scroll",this.handleScroll),$(window).on("resize",this.handleResize)}removeEventListeners(){console.log(this.pageTag+" :: removeEventListeners"),this.$scrollingContent.off("scroll",this.handleScroll),$(window).off("resize",this.handleResize)}loadMorePosts(){this.rafId&&cancelAnimationFrame(this.rafId),this.loading?console.log(this.pageTag+" :: loadMorePosts :: loading Returning"):this.rafId=window.requestAnimationFrame(()=>{var e=this.$scrollingContent[0].scrollHeight-this.$scrollingContent.innerHeight()-this.offset;this.$scrollingContent.scrollTop()>=e?this.fetchPosts():console.log(this.pageTag+" :: loadMorePosts :: Not at the bottom")})}fetchPosts(){this.loading=!0,this.showLoader();let e=`page/${++this.currentPage}/`;console.log(this.pageTag+" :: fetchPosts :: "+e),setTimeout(()=>{$.ajax({url:this.baseUrl+e,type:"GET",success:e=>{console.log(this.pageTag+" :: fetchPosts :: success"),this.disposed?console.log(this.pageTag+" :: fetchPosts :: not updating after success"):((e=$(e).find(".gh-card, .post")).hide(),$(".gh-post-feed").append(e),this.hideLoader(e))},error:e=>{this.disposed?console.log(this.pageTag+" :: fetchPosts :: not updating after error"):(console.log(this.pageTag+" :: fetchPosts :: error"),404===e.status&&this.removeEventListeners(),this.hideLoader())},complete:()=>{console.log(this.pageTag+" :: fetchPosts :: complete"),this.currentPage>=this.maxPages&&this.removeEventListeners(),this.loading=!1}})},1e4)}showLoader(){$(".gh-post-feed-footer-info").addClass("hide");var e=$(".gh-more-post-loader #more-loader");this.animation=bodymovin.loadAnimation({container:e[0],renderer:"svg",loop:!0,autoplay:!0,path:"/assets/lottie/loading.json"}),e.stop().fadeIn(300,"linear")}hideLoader(e){let s=$(".gh-more-post-loader #more-loader");s.stop().fadeOut(300,"linear",()=>{e&&e.fadeIn(300,"linear"),$(".gh-post-feed-footer-info").removeClass("hide"),s.children().empty(),this.animation&&(this.animation.stop(),this.animation.destroy())})}handleScroll(){this.loadMorePosts()}handleResize(){this.loadMorePosts()}cleanUp(){this.disposed=!0,this.hideLoader(),this.removeEventListeners()}}
//# sourceMappingURL=load-more.js.map